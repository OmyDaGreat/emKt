= emKt — A lightweight Kotlin Multiplatform Signal library
:toc: left
:toclevels: 3
:source-highlighter: highlightjs
:icons: font

A small, idiomatic Kotlin Multiplatform library that provides a Signal abstraction
for emitting typed events and connecting handlers across platforms (JVM, Android,
JS, WASM, Native).

== Overview

emKt offers a minimal, coroutine-friendly signaling utility inspired by Godot's
signals. It is implemented with Kotlin's Flow APIs and is designed for simple
pub/sub messaging inside multiplatform libraries and applications.

Key concepts:

* Signal<T> — a hot event source that emits values of type `T`.
* SignalData<T> — a wrapper that carries a value plus optional named parameters.
* Connection — a small handle that can cancel a connection created by
  `Signal.connect()`.

== Features

* Kotlin Multiplatform — use the library on JVM, Android, JavaScript, WASM and
  Native targets.
* Coroutine friendly — built on kotlinx.coroutines and Flow.
* Small API surface — easy to read and integrate.

== Quick start

=== Add the dependency

emKt is configured for Maven Central publishing in this template. Replace
`<version>` with the current release (check repository tags/releases):

[source,groovy]
----
// Gradle (Kotlin DSL)
implementation("xyz.malefic:emkt:<version>")
----

[source,xml]
----
<!-- Maven -->
<dependency>
  <groupId>xyz.malefic</groupId>
  <artifactId>emkt</artifactId>
  <version>&lt;version&gt;</version>
</dependency>
----

== API examples

Below are common usage patterns. Import the package by adding the following import in your Kotlin files: `import xyz.malefic.emkt.*`

=== Basic Signal usage

[source,kotlin]
----
val signal = Signal<String>()

// Using an external CoroutineScope
val scope = MainScope()
scope.launch {
  signal.flow.collect { value ->
    println("Received: $value")
  }
}

// Emitting
suspend fun send() {
  signal.emit("hello")
}
----

=== Using connect() which returns a Connection

[source,kotlin]
----
val connection = signal.connect { value ->
  println("Connected handler: $value")
}

// Later, cancel the connection
connection.cancel()
----

=== Emitting values with parameters

[source,kotlin]
----
// Create a SignalData with named params
val data = signal.withParams("click", mapOf("x" to 10, "y" to 20))

// Emit the SignalData directly, or use emitWithParams to merge params
suspend fun emitWithExtra() {
  signal.emitWithParams("click", mapOf("button" to "left"))
}

// In a collector you can safely cast to SignalData when applicable
----

== Design notes

* Signals are backed by MutableSharedFlow so multiple collectors can receive
  the same emissions.
* `emitWithParams` will wrap values into `SignalData` and merge params when
  appropriate.
* `connect()` without a scope creates an internal SupervisorJob and
  CoroutineScope; it returns a `Connection` that cancels both the collection
  job and the parent job.

== Building & testing

Prerequisites:

* JDK 11+
* Gradle 8+

Build the library (all targets configured in this repo):

[source,bash]
----
./gradlew build
----

Run the library tests (common tests plus platform tests as configured):

[source,bash]
----
./gradlew allTests
----

Generate Dokka documentation:

[source,bash]
----
./gradlew dokkaGenerate
----

== Publishing

This repository includes a pre-configured publishing setup. See `library/build.gradle.kts`
and `gradle.properties` for coordinates and signing configuration. To publish
manually (local or to Maven Central when credentials are set):

[source,bash]
----
./gradlew publishToMavenCentral
----

For automated publishing the project expects GitHub Secrets for GPG and Sonatype
credentials — see `gradle.properties` and repository workflows for details.

== Contributing

Contributions are welcome. Suggested workflow:

1. Fork the repository
2. Create a feature branch
3. Add tests for new behavior (commonTest where possible)
4. Open a pull request

Please follow Kotlin style and keep changes focused and tested.

== License

This project is published under the MIT License — see the LICENSE file for
details.

== Contact / Maintainer

Maintainer: Om Gupta (OmyDaGreat) — ogupta4242@gmail.com

* Repository: https://github.com/OmyDaGreat/emKt
